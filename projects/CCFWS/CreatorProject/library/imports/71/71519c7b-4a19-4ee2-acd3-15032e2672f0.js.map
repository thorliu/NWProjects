{"version":3,"sources":["../../../../../../../assets/resources/scripts/fws/net/assets/resources/scripts/fws/net/WebClient.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../../assets/resources/scripts/fws/net","sourcesContent":["/*\n * web请求 (短连接)\n * @Author: 刘强 \n * @Date: 2018-07-16 17:37:04 \n * @Last Modified by: 刘强\n * @Last Modified time: 2018-08-01 14:24:57\n */\n\n\nimport HttpUtils = require('../utils/HttpUtils');\nimport FWSEnv = require('../FWSEnv');\nimport X = require('../utils/X');\n\n\n\nmodule WebClient\n{\n\t/** GET超时时间 */\n\texport const GET_OVERTIME: number = 1000 * 5;\n\n\t/** POST超时时间 */\n\texport const POST_OVERTIME: number = 1000 * 10;\n\n\t/**\n\t * uri检查方法类型\n\t * @export\n\t * @interface uriCheckerType\n\t */\n\texport interface uriCheckerType\n\t{\n\t\t(uri: string, data: any): string\n\t}\n\n\t/**\n\t * 参数对象检查方法类型\n\t * @export\n\t * @interface dataCheckerType\n\t */\n\texport interface dataCheckerType\n\t{\n\t\t(data: any): void\n\t}\n\n\t/**\n\t * uri检查方法类型\n\t */\n\texport var uriChecker: uriCheckerType = function (uri: string, data: any): string\n\t{\n\t\tif (!data) return uri;\n\n\t\t// data.appid = 2;\n\t\t// data.token = \"abcdefghijklmnopqrstuvwxyz\";\n\t\t// data.time = new Date().getTime();\n\n\t\tvar ret: string = uri + \"\";\n\n\t\t\n\n\t\tvar keys: string[] = Object.keys(data);\n\t\tif(keys.length === 0) return ret;\n\n\t\tif (ret.indexOf(\"?\") < 0)\n\t\t{\n\t\t\tret += \"?\";\n\t\t}\n\n\t\tfor (var i: number = 0; i < keys.length; i++)\n\t\t{\n\t\t\tlet k: string = keys[i];\n\t\t\tlet v: any = data[k];\n\t\t\tv = encodeURIComponent(v);\n\t\t\tret += \"&\" + k + \"=\" + v;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * POST参数检查器\n\t */\n\texport var postChecker: dataCheckerType = function (data: any): any\n\t{\n\t\tif (typeof (data) !== \"object\") return \"\";\n\n\t\tvar arr: any[] = new Array();\n\t\tvar i: number = 0;\n\t\tfor (var attr in data)\n\t\t{\n\t\t\tarr[i] = attr + \"=\" + encodeURIComponent(data[attr]);\n\t\t\ti++;\n\t\t}\n\n\t\treturn arr.join(\"&\");\n\t}\n\n\t/** 发起GET请求 */\n\texport function get(\n\t\turi: string,\n\t\tdata: any,\n\t\tcallbackTarget: any,\n\t\tsuccessHandler: Function,\n\t\tfailHandler: Function): void\n\t{\n\t\tif (!HttpUtils.URL.isUrl(uri))\n\t\t{\n\t\t\turi = FWSEnv.API_BASE_URL + uri;\n\t\t}\n\n\t\tvar request: XMLHttpRequest = new XMLHttpRequest();\n\t\tvar url: string = uriChecker ? uriChecker(uri, data) : uri;\n\t\trequest.open(\"GET\", url);\n\t\trequest.timeout = GET_OVERTIME;\n\t\trequest.setRequestHeader(\"content-type\", \"text/plain;charset=UTF-8\");\n\t\trequest.onerror = request.ontimeout = function (): void\n\t\t{\n\t\t\tif (request.readyState !== 4)\n\t\t\t{\n\t\t\t\tif (failHandler) failHandler.call(callbackTarget, request);\n\t\t\t}\n\t\t};\n\t\trequest.onreadystatechange = function (): void\n\t\t{\n\t\t\tif (request.readyState === 4)\n\t\t\t{\n\t\t\t\tif ((request.status >= 200 && request.status < 300) || request.status == 304)\n\t\t\t\t{\n\t\t\t\t\tif (successHandler) successHandler.call(callbackTarget, request);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (failHandler) failHandler.call(callbackTarget, request);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\trequest.send();\n\n\t}\n\n\t/** 发起POST请求 */\n\texport function post(\n\t\turi: string,\n\t\tgetData: any,\n\t\tpostData: any,\n\t\tcallbackTarget: any,\n\t\tsuccessHandler: Function,\n\t\tfailHandler: Function): void\n\t{\n\t\tif (!HttpUtils.URL.isUrl(uri)) \n\t\t{\n\t\t\turi = FWSEnv.API_BASE_URL + uri;\n\t\t}\n\n\t\tvar request: XMLHttpRequest = new XMLHttpRequest();\n\t\tvar url: string = uriChecker ? uriChecker(uri, getData) : uri;\n\t\trequest.open(\"POST\", url, true);\n\t\trequest.timeout = POST_OVERTIME;\n\t\trequest.setRequestHeader(\"content-type\", \"application/x-www-form-urlencoded\");\n\t\trequest.onerror = request.ontimeout = function ()\n\t\t{\n\t\t\tif (request.readyState !== 4)\n\t\t\t{\n\t\t\t\tif (failHandler) failHandler.call(callbackTarget, request);\n\t\t\t}\n\t\t}\n\t\trequest.onreadystatechange = function ()\n\t\t{\n\t\t\tif (request.readyState == 4)\n\t\t\t{\n\t\t\t\tif ((request.status >= 200 && request.status < 300) || request.status == 304)\n\t\t\t\t{\n\t\t\t\t\tif (successHandler) successHandler.call(callbackTarget, request);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (failHandler) failHandler.call(callbackTarget, request);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (postChecker) postData = postChecker(postData);\n\t\trequest.send(postData);\n\t}\n}\n\nexport = WebClient;\n\n// const GLOBAL_YY = window[\"GLOBAL_YY\"] || {};\n// GLOBAL_YY.YYWebClient = YYWebClient;"]}