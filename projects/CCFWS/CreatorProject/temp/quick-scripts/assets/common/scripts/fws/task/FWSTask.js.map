{"version":3,"sources":["FWSTask.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../../assets/resources/scripts/fws/task","sourcesContent":["/*\n * 任务项\n * @Author: 刘强 \n * @Date: 2018-07-16 11:56:39 \n * @Last Modified by: 刘强\n * @Last Modified time: 2018-07-31 17:21:45\n */\n\nimport FWSCommon = require('../core/FWSCommon');\n\n\n\nmodule FWSTask\n{\n\t/** 表示一个基础的任务项 */\n\texport class Task\n\t{\n\t\tprotected _alreadyBegin: boolean = false;\n\t\tprotected _alreadyCompoleted: boolean = false;\n\n\t\tprotected _beginTimer: number = 0;\n\t\tprotected _endTimer: number = 0;\n\n\t\tconstructor() { }\n\n\t\tpublic reset(): void\n\t\t{\n\t\t\tthis._alreadyBegin = false;\n\t\t\tthis._alreadyCompoleted = false;\n\t\t}\n\n\t\tpublic begin(): void\n\t\t{\n\t\t\tif (this._alreadyBegin) return;\n\t\t\tthis._alreadyBegin = true;\n\t\t\tthis._beginTimer = new Date().getTime();\n\t\t\tif (this.onBegin && this.onBegin.handler)\n\t\t\t{\n\t\t\t\tthis.onBegin.handler.call(this.onBegin.target, this, this.onBegin.data);\n\t\t\t}\n\t\t}\n\n\t\tpublic cancel(): void\n\t\t{\n\t\t\tthis._alreadyBegin = false;\n\t\t\tthis._alreadyCompoleted = false;\n\t\t}\n\n\t\tpublic get completed(): boolean { return this._alreadyCompoleted; }\n\n\t\tpublic get progress(): number { return this._alreadyCompoleted ? 1 : 0; }\n\t\tpublic get beginTimer(): number { return this._beginTimer; }\n\t\tpublic get endTimer(): number { return this._endTimer; }\n\t\tpublic get useTime(): number \n\t\t{\n\t\t\tif (this._endTimer <= 0 || this._beginTimer <= 0) return -1;\n\t\t\treturn this._endTimer - this._beginTimer;\n\t\t}\n\n\t\tpublic onBegin: FWSCommon.CallbackHandler;\n\t\tpublic onProgress: FWSCommon.CallbackHandler;\n\t\tpublic onCompleted: FWSCommon.CallbackHandler;\n\t\tpublic onError: FWSCommon.CallbackHandler;\n\t}\n\n\n\texport class TaskList extends Task\n\t{\n\t\tprotected _tasks: Task[] = [];\n\t\tpublic _taskIndex: number = 0;\n\n\t\tconstructor()\n\t\t{\n\t\t\tsuper();\n\t\t}\n\n\t\tprotected initTaskCallbacks(task: Task): void\n\t\t{\n\t\t\ttask.onBegin = { handler: this.onTaskBegin, target: this, data: task };\n\t\t\ttask.onCompleted = { handler: this.onTaskCompleted, target: this, data: task };\n\t\t\ttask.onError = { handler: this.onTaskError, target: this, data: task };\n\t\t\ttask.onProgress = { handler: this.onTaskProgress, target: this, data: task };\n\t\t}\n\n\t\tprotected onTaskBegin(list: TaskList, task: Task): void\n\t\t{\n\t\t}\n\n\t\tprotected onTaskCompleted(list: TaskList, task: Task): void\n\t\t{\n\t\t\tif (this.onProgress && this.onProgress.handler)\n\t\t\t{\n\t\t\t\tthis.onProgress.handler.call(this.onProgress.target, this, task);\n\t\t\t}\n\n\t\t\tthis._taskIndex++;\n\n\t\t\t// setTimeout(this.beginNextTask, 0, this);\n\t\t\tvar self: TaskList = this;\n\t\t\tsetTimeout(function ()\n\t\t\t{\n\t\t\t\tself.beginNextTask(self);\n\t\t\t}, 0);\n\t\t}\n\n\t\tprotected onTaskProgress(list: TaskList, task: Task): void\n\t\t{\n\t\t\tif (this.onProgress && this.onProgress.handler)\n\t\t\t{\n\t\t\t\tthis.onProgress.handler.call(this.onProgress.target, this, task);\n\t\t\t}\n\t\t}\n\n\t\tprotected onTaskError(list: TaskList, task: Task): void\n\t\t{\n\t\t\tif (this.onError && this.onError.handler)\n\t\t\t{\n\t\t\t\tthis.onError.handler.call(this.onError.target, this, task);\n\t\t\t}\n\t\t}\n\n\t\tprotected beginNextTask(self: TaskList): void\n\t\t{\n\t\t\tconsole.log(\"this\", this);\n\t\t\tconsole.log(\"self\", self);\n\n\t\t\tif (self._taskIndex >= self._tasks.length)\n\t\t\t{\n\t\t\t\tself._alreadyCompoleted = true;\n\t\t\t\tself._endTimer = new Date().getTime();\n\t\t\t\tif (self.onCompleted && self.onCompleted.handler)\n\t\t\t\t{\n\t\t\t\t\tself.onCompleted.handler.call(self.onCompleted.target, self, self.onCompleted.data);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar task: Task = self._tasks[self._taskIndex];\n\t\t\tself.initTaskCallbacks(task);\n\t\t\ttask.begin();\n\t\t}\n\n\t\tpublic reset(): void\n\t\t{\n\t\t\tfor (var i: number = 0; i < this._tasks.length; i++)\n\t\t\t{\n\t\t\t\tvar task: Task = this._tasks[i];\n\t\t\t\ttask.cancel();\n\t\t\t\ttask.reset();\n\t\t\t}\n\n\t\t\tthis._taskIndex = 0;\n\t\t}\n\n\t\tpublic begin(): void\n\t\t{\n\t\t\tthis.beginNextTask(this);\n\t\t\tif (this.onBegin && this.onBegin.handler)\n\t\t\t{\n\t\t\t\tthis.onBegin.handler.call(this.onBegin.target, this, this.onBegin.data);\n\t\t\t}\n\t\t}\n\n\t\tpublic cancel(): void\n\t\t{\n\t\t\tthis.reset();\n\t\t}\n\n\t\tpublic add(task: Task): void\n\t\t{\n\t\t\tif (!task) return;\n\t\t\tthis._tasks.push(task);\n\t\t}\n\n\t\tpublic get progress(): number\n\t\t{\n\t\t\tif (this._tasks.length > 0)\n\t\t\t{\n\t\t\t\tvar ret: number = 0;\n\t\t\t\tvar pre: number = 1.0 / this._tasks.length;\n\n\t\t\t\tfor (var i: number = 0; i < this._tasks.length; i++)\n\t\t\t\t{\n\t\t\t\t\tret += pre * this._tasks[i].progress;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n\nexport = FWSTask;"]}